<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Phantoms007">



<meta name="description" content="如何优化千万级大表前言千万级大表如何优化，这是一个很有技术含量的问题，通常我们的直觉思维都会跳转到拆分或者数据分区，在此我想做一些补充和梳理，想和大家做一些这方面的经验总结，也欢迎大家提出建议。 从一开始脑海里开始也是火光四现，到不断的自我批评，后来也参考了一些团队的经验，我整理了下面的大纲内容。">
<meta name="keywords" content="Mysql,优化,分表,架构">
<meta property="og:type" content="article">
<meta property="og:title" content="如何优化千万级大表">
<meta property="og:url" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/index.html">
<meta property="og:site_name" content="随笔小记">
<meta property="og:description" content="如何优化千万级大表前言千万级大表如何优化，这是一个很有技术含量的问题，通常我们的直觉思维都会跳转到拆分或者数据分区，在此我想做一些补充和梳理，想和大家做一些这方面的经验总结，也欢迎大家提出建议。 从一开始脑海里开始也是火光四现，到不断的自我批评，后来也参考了一些团队的经验，我整理了下面的大纲内容。">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/大纲.jpg">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/业务策略.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/优化1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/优化2.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/规范1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/命名1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/业务优化1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account2.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account3.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account4.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account5.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account6.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/account7.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/架构1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/架构2.jpg">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/架构3.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/数据库1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/管理1.png">
<meta property="og:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/管理2.png">
<meta property="og:updated_time" content="2020-04-30T10:41:19.926Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何优化千万级大表">
<meta name="twitter:description" content="如何优化千万级大表前言千万级大表如何优化，这是一个很有技术含量的问题，通常我们的直觉思维都会跳转到拆分或者数据分区，在此我想做一些补充和梳理，想和大家做一些这方面的经验总结，也欢迎大家提出建议。 从一开始脑海里开始也是火光四现，到不断的自我批评，后来也参考了一些团队的经验，我整理了下面的大纲内容。">
<meta name="twitter:image" content="https://phantoms007.github.io/2020/04/29/如何优化千万级大表/大纲.jpg">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="随笔小记" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/AcFun.png">



    <link href="/js/animate.min.css" rel="stylesheet">



    <link href="/js/jquery.fancybox.min.css" rel="stylesheet">



    <script src="/js/pace.min.js"></script>
   

    <link href="/js/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">



<link href="/js/font-awesome.min.css" rel="stylesheet">


<title>如何优化千万级大表 | 随笔小记</title>

<script src="/js/jquery-2.2.4.min.js"></script>
<script src="/js/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "/js/jquery.fancybox.min.js",
        scrollreveal: "/js/scrollreveal.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "/js/jquery-ui.min.js", "/js/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    


</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/AcFun.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Phantoms007</a></h1>
        </hgroup>

        
        <p class="header-subtitle">时间是生命的度量衡，人类文明的意义是知识的学习与传承</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false">
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="/203406918@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa 知乎" href="/zhihu" title="知乎"></a>
                            
                                <a class="fa 豆瓣" href="/douban" title="豆瓣"></a>
                            
                                <a class="fa 简书" href="/jianshu" title="简书"></a>
                            
                                <a class="fa CSDN" href="/" title="CSDN"></a>
                            
                                <a class="fa QQ" href="#" title="QQ"></a>
                            
                                <a class="fa 微信" href="/Wechat" title="微信"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ABA/">ABA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAS/">CAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Get/">Get</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySql/">MySql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PDF/">PDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Post/">Post</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sphinx/">Sphinx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/innodb/">innodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/优化/">优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分表/">分表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前后交互/">前后交互</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/扣款/">扣款</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库设计/">数据库设计</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/秒杀/">秒杀</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/索引/">索引</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/请求方式/">请求方式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/锁/">锁</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">时间是生命的度量衡，人类文明的意义是知识的学习与传承</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Phantoms007</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/AcFun.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Phantoms007</a></h1>
            </hgroup>
            
            <p class="header-subtitle">时间是生命的度量衡，人类文明的意义是知识的学习与传承</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/203406918@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="/zhihu" title="知乎"></a>
                            
                                <a class="fa 豆瓣" target="_blank" href="/douban" title="豆瓣"></a>
                            
                                <a class="fa 简书" target="_blank" href="/jianshu" title="简书"></a>
                            
                                <a class="fa CSDN" target="_blank" href="/" title="CSDN"></a>
                            
                                <a class="fa QQ" target="_blank" href="#" title="QQ"></a>
                            
                                <a class="fa 微信" target="_blank" href="/Wechat" title="微信"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-如何优化千万级大表" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/04/29/如何优化千万级大表/" class="article-date">
      <time datetime="2020-04-29T12:00:00.000Z" itemprop="datePublished">2020-04-29</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      如何优化千万级大表
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/优化/">优化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分表/">分表</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <excerpt in index | 首页摘要>




<h2 id="如何优化千万级大表"><a href="#如何优化千万级大表" class="headerlink" title="如何优化千万级大表"></a>如何优化千万级大表</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>千万级大表如何优化，这是一个很有技术含量的问题，通常我们的直觉思维都会跳转到拆分或者数据分区，在此我想做一些补充和梳理，想和大家做一些这方面的经验总结，也欢迎大家提出建议。</p>
<p>从一开始脑海里开始也是火光四现，到不断的自我批评，后来也参考了一些团队的经验，我整理了下面的大纲内容。</p>
<a id="more"></a>
<the rest of contents | 余下全文>

<p><img src="/2020/04/29/如何优化千万级大表/大纲.jpg" alt></p>
<p>既然要吃透这个问题，我们势必要回到本源，我把这个问题分为三部分:</p>
<p><strong>千万级</strong>，<strong>大表</strong>，<strong>优化</strong>，</p>
<p>也分别对应我们在图中标识的</p>
<p><strong>数据量</strong>，<strong>对象</strong> 和 <strong>目标</strong>。</p>
<p>接下来逐步展开说明一下，从而给出一系列的解决方案。</p>
<h3 id="数据量：千万级"><a href="#数据量：千万级" class="headerlink" title="数据量：千万级"></a>数据量：千万级</h3><p>千万级其实只是一个感官的数字，就是我们印象中的数据量大。 这里我们需要把这个概念细化，因为随着业务和时间的变化，数据量也会有变化，我们应该是带着一种动态思维来审视这个指标，从而对于不同的场景我们应该有不同的处理策略。</p>
<h4 id="1-数据量为千万级，可能达到亿级或者更高"><a href="#1-数据量为千万级，可能达到亿级或者更高" class="headerlink" title="1)数据量为千万级，可能达到亿级或者更高"></a>1)数据量为千万级，可能达到亿级或者更高</h4><p>通常是一些数据流水，日志记录的业务，里面的数据随着时间的增长会逐步增多，超过千万门槛是很容易的一件事情。</p>
<h4 id="2-数据量为千万级，是一个相对稳定的数据量"><a href="#2-数据量为千万级，是一个相对稳定的数据量" class="headerlink" title="2)数据量为千万级，是一个相对稳定的数据量"></a>2)数据量为千万级，是一个相对稳定的数据量</h4><p>如果数据量相对稳定，通常是在一些偏向于状态的数据，比如有1000万用户，那么这些用户的信息在表中都有相应的一行数据记录，随着业务的增长，这个量级相对是比较稳定的。</p>
<h4 id="3-数据量为千万级，不应该有这么多的数据"><a href="#3-数据量为千万级，不应该有这么多的数据" class="headerlink" title="3)数据量为千万级，不应该有这么多的数据"></a>3)数据量为千万级，不应该有这么多的数据</h4><p>这种情况是我们被动发现的居多，通常发现的时候已经晚了，比如你看到一个配置表，数据量上千万;或者说一些表里的数据已经存储了很久，99%的数据都属于过期数据或者垃圾数据。</p>
<p>数据量是一个整体的认识，我们需要对数据做更近一层的理解，这就可以引出第二个部分的内容。</p>
<h3 id="对象：数据表"><a href="#对象：数据表" class="headerlink" title="对象：数据表"></a>对象：数据表</h3><p>数据操作的过程就好比数据库中存在着多条管道，这些管道中都流淌着要处理的数据，这些数据的用处和归属是不一样的。</p>
<p>一般根据业务类型把数据分为三种：</p>
<h4 id="（1）流水型数据"><a href="#（1）流水型数据" class="headerlink" title="（1）流水型数据"></a>（1）流水型数据</h4><p>流水型数据是无状态的，多笔业务之间没有关联，每次业务过来的时候都会产生新的单据，比如交易流水、支付流水，只要能插入新单据就能完成业务，特点是后面的数据不依赖前面的数据，所有的数据按时间流水进入数据库。</p>
<h4 id="（2）状态型数据"><a href="#（2）状态型数据" class="headerlink" title="（2）状态型数据"></a>（2）状态型数据</h4><p>状态型数据是有状态的，多笔业务之间依赖于有状态的数据，而且要保证该数据的准确性，比如充值时必须要拿到原来的余额，才能支付成功。</p>
<h4 id="（3）配置型数据"><a href="#（3）配置型数据" class="headerlink" title="（3）配置型数据"></a>（3）配置型数据</h4><p>此类型数据数据量较小，而且结构简单，一般为静态数据，变化频率很低。</p>
<p>至此，我们可以对整体的背景有一个认识了，如果要做优化，其实要面对的是这样的3<em>3的矩阵，如果要考虑表的读写比例（读多写少，读少写多…），那么就会是3</em>3*4=24种，显然做穷举是不显示的，而且也完全没有必要，可以针对不同的数据存储特性和业务特点来指定不同的业务策略。</p>
<p>对此我们采取抓住重点的方式，把常见的一些优化思路梳理出来，尤其是里面的核心思想，也是我们整个优化设计的一把尺子，而难度决定了我们做这件事情的动力和风险。</p>
<p><img src="/2020/04/29/如何优化千万级大表/业务策略.png" alt></p>
<p>而对于优化方案，我想采用面向业务的维度来进行阐述。</p>
<h3 id="目标：优化"><a href="#目标：优化" class="headerlink" title="目标：优化"></a>目标：优化</h3><p>在这个阶段，我们要说优化的方案了，总结的有点多，相对来说是比较全了。</p>
<p>整体分为五个部分：<br><img src="/2020/04/29/如何优化千万级大表/优化1.png" alt></p>
<p>其实我们通常所说的分库分表等方案只是其中的一小部分，如果展开之后就比较丰富了。<br><img src="/2020/04/29/如何优化千万级大表/优化2.png" alt></p>
<p>其实不难理解，我们要支撑的表数据量是千万级别，相对来说是比较大了，DBA要维护的表肯定不止一张，如何能够更好的管理，同时在业务发展中能够支撑扩展，同时保证性能，这是摆在我们面前的几座大山。</p>
<h2 id="改进方案"><a href="#改进方案" class="headerlink" title="改进方案"></a>改进方案</h2><h3 id="规范设计"><a href="#规范设计" class="headerlink" title="规范设计"></a>规范设计</h3><p>在此我们先提到的是规范设计，而不是其他高大上的设计方案。</p>
<p>黑格尔说：秩序是自由的第一条件。在分工协作的工作场景中尤其重要，否则团队之间互相牵制太多，问题多多。</p>
<p>规范设计我想提到如下的几个规范，其实只是属于开发规范的一部分内容，可以作为参考。<br><img src="/2020/04/29/如何优化千万级大表/规范1.png" alt></p>
<p>规范的本质不是解决问题，而是有效杜绝一些潜在问题，对于千万级大表要遵守的规范，我梳理了如下的一些细则，基本可以涵盖我们常见的一些设计和使用问题，比如表的字段设计不管三七二十一，都是varchar(500),其实是很不规范的一种实现方式，我们来展开说一下这几个规范。</p>
<h4 id="配置规范"><a href="#配置规范" class="headerlink" title="配置规范"></a>配置规范</h4><p>（1）MySQL数据库默认使用InnoDB存储引擎。</p>
<p>（2）保证字符集设置统一，MySQL数据库相关系统、数据库、表的字符集使都用UTF8，应用程序连接、展示等可以设置字符集的地方也都统一设置为UTF8字符集。</p>
<p>注：UTF8格式是存储不了表情类数据，需要使用UTF8MB4，可在MySQL字符集里面设置。在8.0中已经默认为UTF8MB4，可以根据公司的业务情况进行统一或者定制化设置。</p>
<p>（3）MySQL数据库的事务隔离级别默认为RR（Repeatable-Read），建议初始化时统一设置为RC（Read-Committed），对于OLTP业务更适合。</p>
<p>（4）数据库中的表要合理规划，控制单表数据量，对于MySQL数据库来说，建议单表记录数控制在2000W以内。</p>
<p>（5）MySQL实例下，数据库、表数量尽可能少；数据库一般不超过50个，每个数据库下，数据表数量一般不超过500个（包括分区表）。</p>
<h4 id="建表规范"><a href="#建表规范" class="headerlink" title="建表规范"></a>建表规范</h4><p>（1）InnoDB禁止使用外键约束，可以通过程序层面保证。</p>
<p>（2）存储精确浮点数必须使用DECIMAL替代FLOAT和DOUBLE。</p>
<p>（3）整型定义中无需定义显示宽度，比如：使用INT，而不是INT(4)。</p>
<p>（4）不建议使用ENUM类型，可使用TINYINT来代替。</p>
<p>（5）尽可能不使用TEXT、BLOB类型，如果必须使用，建议将过大字段或是不常用的描述型较大字段拆分到其他表中；另外，禁止用数据库存储图片或文件。</p>
<p>（6）存储年时使用YEAR(4)，不使用YEAR(2)。</p>
<p>（7）建议字段定义为NOT NULL。</p>
<p>（8）建议DBA提供SQL审核工具，建表规范性需要通过审核工具审核后</p>
<h4 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h4><p>（1）库、表、字段全部采用小写。</p>
<p>（2）库名、表名、字段名、索引名称均使用小写字母，并以“_”分割。</p>
<p>（3）库名、表名、字段名建议不超过12个字符。（库名、表名、字段名支持最多64个字符，但为了统一规范、易于辨识以及减少传输量，统一不超过12字符）</p>
<p>（4）库名、表名、字段名见名知意，不需要添加注释。</p>
<p>对于对象命名规范的一个简要总结如下表4-1所示，供参考。</p>
<p>命名列表<br><img src="/2020/04/29/如何优化千万级大表/命名1.png" alt></p>
<h4 id="索引规范"><a href="#索引规范" class="headerlink" title="索引规范"></a>索引规范</h4><p>（1）索引建议命名规则：idx_col1_col2[_colN]、uniq_col1_col2[_colN]（如果字段过长建议采用缩写）。</p>
<p>（2）索引中的字段数建议不超过5个。</p>
<p>（3）单张表的索引个数控制在5个以内。</p>
<p>（4）InnoDB表一般都建议有主键列，尤其在高可用集群方案中是作为必须项的。</p>
<p>（5）建立复合索引时，优先将选择性高的字段放在前面。(选择性高是指能够过滤掉更多不需要的记录。举例来说，在一个公司里，使用性别只能过滤掉一半的人，而使用姓名一般可以过滤掉99%以上的人，因为会有重名情况，而使用员工号，选出一个，其他的全部过滤掉。也就是说，员工号的选择性最高。)</p>
<p>（6）UPDATE、DELETE语句需要根据WHERE条件添加索引。</p>
<p>（7）不建议使用%前缀模糊查询，例如 LIKE “%weibo” ，无法用到索引，会导致全表扫描。</p>
<p>（8）合理利用覆盖索引，例如：</p>
<p>（9）SELECT email,uid FROM user_email WHERE uid=xx，如果uid不是主键，可以创建覆盖索引idx_uid_email(uid,email)来提高查询效率。</p>
<p>（10）避免在索引字段上使用函数，否则会导致查询时索引失效。</p>
<p>（11）确认索引是否需要变更时要联系DBA。</p>
<h4 id="应用规范"><a href="#应用规范" class="headerlink" title="应用规范"></a>应用规范</h4><p>（1）避免使用存储过程、触发器、自定义函数等，容易将业务逻辑和DB耦合在一起，后期做分布式方案时会成为瓶颈。</p>
<p>（2）考虑使用UNION ALL，减少使用UNION，因为UNION ALL不去重，而少了排序操作，速度相对比UNION要快，如果没有去重的需求，优先使用UNION ALL。</p>
<p>（3）考虑使用limit N，少用limit M，N，特别是大表或M比较大的时候。</p>
<p>（4）减少或避免排序，如：group by语句中如果不需要排序，可以增加order by null。</p>
<p>（5）统计表中记录数时使用COUNT(<em>)，而不是COUNT(primary_key)和COUNT(1)；InnoDB表避免使用COUNT(</em>)操作，计数统计实时要求较强可以使用Memcache或者Redis，非实时统计可以使用单独统计表，定时更新。</p>
<p>（6）做字段变更操作（modify column/change column）的时候必须加上原有的注释属性，否则修改后，注释会丢失。</p>
<p>（7）使用prepared statement可以提高性能并且避免SQL注入。</p>
<p>（8）SQL语句中IN包含的值不应过多。</p>
<p>（9）UPDATE、DELETE语句一定要有明确的WHERE条件。</p>
<p>（10）WHERE条件中的字段值需要符合该字段的数据类型，避免MySQL进行隐式类型转化。</p>
<p>（11）SELECT、INSERT语句必须显式的指明字段名称，禁止使用SELECT * 或是INSERT INTO table_name values。</p>
<p>（12）INSERT语句使用batch提交（INSERT INTO table_name VALUES,,……），values的个数不应过多。</p>
<h3 id="业务层优化"><a href="#业务层优化" class="headerlink" title="业务层优化"></a>业务层优化</h3><p>业务层优化应该是收益最高的优化方式了，而且对于业务层完全可见，主要有业务拆分，数据拆分和两类常见的优化场景（读多写少，读少写多）</p>
<p><img src="/2020/04/29/如何优化千万级大表/业务优化1.png" alt><br>1）业务拆分</p>
<p>将混合业务拆分为独立业务</p>
<p>将状态和历史数据分离</p>
<p>业务拆分其实是把一个混合的业务剥离成为更加清晰的独立业务，这样业务1，业务2。。。独立的业务使得业务总量依旧很大，但是每个部分都是相对独立的，可靠性依然有保证。</p>
<p>对于状态和历史数据分离，我可以举一个例子来说明。</p>
<p>例如：我们有一张表Account，假设用户余额为100。<br><img src="/2020/04/29/如何优化千万级大表/account.png" alt></p>
<p>我们需要在发生数据变更后，能够追溯数据变更的历史信息，如果对账户更新状态数据，增加100的余额，这样余额为200。</p>
<p>这个过程可能对应一条update语句，一条insert语句。</p>
<p>对此我们可以改造为两个不同的数据源，account和account_hist</p>
<p>在account_hist中就会是两条insert记录，如下:</p>
<p><img src="/2020/04/29/如何优化千万级大表/account2.png" alt></p>
<p>而在account中则是一条update语句，如下：</p>
<p><img src="/2020/04/29/如何优化千万级大表/account3.png" alt></p>
<p>这也是一种很基础的冷热分离，可以大大减少维护的复杂度，提高业务响应效率。</p>
<p>2）数据拆分</p>
<p>2.1 按照日期拆分，这种使用方式比较普遍，尤其是按照日期维度的拆分，其实在程序层面的改动很小，但是扩展性方面的收益很大。</p>
<p>数据按照日期维度拆分，如test_20191021</p>
<p>数据按照周月为维度拆分,如test_201910</p>
<p>数据按照季度，年维度拆分,如test_2019</p>
<p>2.2 采用分区模式，分区模式也是常见的使用方式，采用hash,range等方式会多一些，在MySQL中我是不大建议使用分区表的使用方式，因为随着存储容量的增长，数据虽然做了垂直拆分，但是归根结底，数据其实难以实现水平扩展，在MySQL中是有更好的扩展方式。</p>
<p>2.3 读多写少优化场景</p>
<p>采用缓存，采用Redis技术，将读请求打在缓存层面，这样可以大大降低MySQL层面的热点数据查询压力。</p>
<p>2.4 读少写多优化场景，可以采用三步走：</p>
<p>1)采用异步提交模式，异步对于应用层来说最直观的就是性能的提升，产生最少的同步等待。</p>
<p>2)使用队列技术，大量的写请求可以通过队列的方式来进行扩展，实现批量的数据写入。</p>
<p>3)降低写入频率，这个比较难理解，我举个例子</p>
<p>对于业务数据，比如积分类，相比于金额来说业务优先级略低的场景，如果数据的更新过于频繁，可以适度调整数据更新的范围（比如从原来的每分钟调整为10分钟）来减少更新的频率。</p>
<p>例如：更新状态数据，积分为200，如下图所示</p>
<p><img src="/2020/04/29/如何优化千万级大表/account4.png" alt></p>
<p>可以改造为，如下图所示。</p>
<p><img src="/2020/04/29/如何优化千万级大表/account5.png" alt></p>
<p>如果业务数据在短时间内更新过于频繁，比如1分钟更新100次，积分从100到10000，则可以根据时间频率批量提交。</p>
<p>例如：更新状态数据，积分为100，如下图所示。</p>
<p><img src="/2020/04/29/如何优化千万级大表/account6.png" alt></p>
<p>无需生成100个事务（200条SQL语句）可以改造为2条SQL语句，如下图所示。</p>
<p><img src="/2020/04/29/如何优化千万级大表/account7.png" alt></p>
<p>对于业务指标，比如更新频率细节信息，可以根据具体业务场景来讨论决定。</p>
<h3 id="架构层优化"><a href="#架构层优化" class="headerlink" title="架构层优化"></a>架构层优化</h3><p>架构层优化其实就是我们认为的那种技术含量很高的工作，我们需要根据业务场景在架构层面引入一些新的花样来。</p>
<p><img src="/2020/04/29/如何优化千万级大表/架构1.png" alt></p>
<p>打开UC浏览器 查看更多精彩图片<br>3.1.系统水平扩展场景</p>
<p>3.1.1采用中间件技术，可以实现数据路由，水平扩展，常见的中间件有MyCAT，ShardingSphere,ProxySQL等</p>
<p><img src="/2020/04/29/如何优化千万级大表/架构2.jpg" alt></p>
<p>3.1.2 采用读写分离技术，这是针对读需求的扩展，更侧重于状态表，在允许一定延迟的情况下，可以采用多副本的模式实现读需求的水平扩展，也可以采用中间件来实现，如MyCAT,ProxySQL,MaxScale,MySQL Router等</p>
<p><img src="/2020/04/29/如何优化千万级大表/架构3.png" alt></p>
<p>打开UC浏览器 查看更多精彩图片<br>3.1.3 采用负载均衡技术，常见的有LVS技术或者基于域名服务的Consul技术等</p>
<p>3.2.兼顾OLTP+OLAP的业务场景，可以采用NewSQL，优先兼容MySQL协议的HTAP技术栈，如TiDB</p>
<p>3.3.离线统计的业务场景，有几类方案可供选择。</p>
<p>3.3.1 采用NoSQL体系，主要有两类，一类是适合兼容MySQL协议的数据仓库体系，常见的有Infobright或者ColumnStore，另外一类是基于列式存储，属于异构方向，如HBase技术</p>
<p>3.3.2采用数仓体系，基于MPP架构,如使用Greenplum统计，如T+1统计</p>
<h3 id="数据库优化"><a href="#数据库优化" class="headerlink" title="数据库优化"></a>数据库优化</h3><p>数据库优化，其实可打的牌也不少，但是相对来说空间没有那么大了，我们来逐个说一下。</p>
<p><img src="/2020/04/29/如何优化千万级大表/数据库1.png" alt></p>
<h3 id="事务优化"><a href="#事务优化" class="headerlink" title="事务优化"></a>事务优化</h3><p>根据业务场景选择事务模型，是否是强事务依赖</p>
<p>对于事务降维策略，我们来举出几个小例子来。</p>
<h4 id="4-1-1-降维策略1：存储过程调用转换为透明的SQL调用"><a href="#4-1-1-降维策略1：存储过程调用转换为透明的SQL调用" class="headerlink" title="4.1.1 降维策略1：存储过程调用转换为透明的SQL调用"></a>4.1.1 降维策略1：存储过程调用转换为透明的SQL调用</h4><p>对于新业务而言，使用存储过程显然不是一个好主意，MySQL的存储过程和其他商业数据库相比，功能和性能都有待验证，而且在目前轻量化的业务处理中，存储过程的处理方式太“重”了。</p>
<p>有些应用架构看起来是按照分布式部署的，但在数据库层的调用方式是基于存储过程，因为存储过程封装了大量的逻辑，难以调试，而且移植性不高，这样业务逻辑和性能压力都在数据库层面了，使得数据库层很容易成为瓶颈，而且难以实现真正的分布式。</p>
<p>所以有一个明确的改进方向就是对于存储过程的改造，把它改造为SQL调用的方式，可以极大地提高业务的处理效率，在数据库的接口调用上足够简单而且清晰可控。</p>
<h4 id="4-1-2-降维策略2：DDL操作转换为DML操作"><a href="#4-1-2-降维策略2：DDL操作转换为DML操作" class="headerlink" title="4.1.2 降维策略2：DDL操作转换为DML操作"></a>4.1.2 降维策略2：DDL操作转换为DML操作</h4><p>有些业务经常会有一种紧急需求，总是需要给一个表添加字段，搞得DBA和业务同学都挺累，可以想象一个表有上百个字段，而且基本都是name1，name2……name100，这种设计本身就是有问题的，更不用考虑性能了。究其原因，是因为业务的需求动态变化，比如一个游戏装备有20个属性，可能过了一个月之后就增加到了40个属性，这样一来，所有的装备都有40个属性，不管用没用到，而且这种方式也存在诸多的冗余。</p>
<p>我们在设计规范里面也提到了一些设计的基本要素，在这些基础上需要补充的是，保持有限的字段，如果要实现这些功能的扩展，其实完全可以通过配置化的方式来实现，比如把一些动态添加的字段转换为一些配置信息。配置信息可以通过DML的方式进行修改和补充，对于数据入口也可以更加动态、易扩展。</p>
<h4 id="4-1-3-降维策略3：Delete操作转换为高效操作"><a href="#4-1-3-降维策略3：Delete操作转换为高效操作" class="headerlink" title="4.1.3 降维策略3：Delete操作转换为高效操作"></a>4.1.3 降维策略3：Delete操作转换为高效操作</h4><p>有些业务需要定期来清理一些周期性数据，比如表里的数据只保留一个月，那么超出时间范围的数据就要清理掉了，而如果表的量级比较大的情况下，这种Delete操作的代价实在太高，我们可以有两类解决方案来把Delete操作转换为更为高效的方式。</p>
<p>第一种是根据业务建立周期表，比如按照月表、周表、日表等维度来设计，这样数据的清理就是一个相对可控而且高效的方式了。</p>
<p>第二种方案是使用MySQL rename的操作方式，比如一张2千万的大表要清理99%的数据，那么需要保留的1%的数据我们可以很快根据条件过滤补录，实现“移形换位”。</p>
<h4 id="4-2-SQL优化"><a href="#4-2-SQL优化" class="headerlink" title="4.2 SQL优化"></a>4.2 SQL优化</h4><p>其实相对来说需要的极简的设计，很多点都在规范设计里面了，如果遵守规范，八九不离十的问题都会杜绝掉，在此补充几点：</p>
<ul>
<li>SQL语句简化，简化是SQL优化的一大利器，因为简单，所以优越。</li>
<li>尽可能避免或者杜绝多表复杂关联，大表关联是大表处理的噩梦，一旦打开了这个口子，越来越多的需求需要关联，性能优化就没有回头路了，更何况大表关联是MySQL的弱项，尽管Hash Join才推出，不要像掌握了绝对大杀器一样，在商业数据库中早就存在，问题照样层出不穷。</li>
<li>SQL中尽可能避免反连接，避免半连接，这是优化器做得薄弱的一方面，什么是反连接，半连接？其实比较好理解，举个例子，not in ,not exists就是反连接，in,exists就是半连接，在千万级大表中出现这种问题，性能是几个数量级的差异。</li>
</ul>
<h4 id="4-3-索引优化"><a href="#4-3-索引优化" class="headerlink" title="4.3 索引优化"></a>4.3 索引优化</h4><p>应该是大表优化中需要把握的一个度。</p>
<ul>
<li>首先必须有主键，规范设计中第一条就是，此处不接收反驳。</li>
<li>其次，SQL查询基于索引或者唯一性索引，使得查询模型尽可能简单。</li>
<li>最后，尽可能杜绝范围数据的查询，范围扫描在千万级大表情况下还是尽可能减少。</li>
</ul>
<h3 id="管理优化"><a href="#管理优化" class="headerlink" title="管理优化"></a>管理优化</h3><p>这部分应该是在所有的解决方案中最容易被忽视的部分了，我放在最后，在此也向运维同事致敬，总是为很多认为本应该正常的问题尽职尽责（背锅）。<br><img src="/2020/04/29/如何优化千万级大表/管理1.png" alt></p>
<p>千万级大表的数据清理一般来说是比较耗时的，在此建议在设计中需要完善冷热数据分离的策略，可能听起来比较拗口，我来举一个例子，把大表的Drop 操作转换为可逆的DDL操作。</p>
<p>Drop操作是默认提交的，而且是不可逆的，在数据库操作中都是跑路的代名词，MySQL层面目前没有相应的Drop操作恢复功能，除非通过备份来恢复，但是我们可以考虑将Drop操作转换为一种可逆的DDL操作。</p>
<p>MySQL中默认每个表有一个对应的ibd文件，其实可以把Drop操作转换为一个rename操作，即把文件从testdb迁移到testdb_arch下面；从权限上来说，testdb_arch是业务不可见的，rename操作可以平滑的实现这个删除功能，如果在一定时间后确认可以清理，则数据清理对于已有的业务流程是不可见的，如下图所示。<br><img src="/2020/04/29/如何优化千万级大表/管理2.png" alt></p>
<p>此外，还有两个额外建议，一个是对于大表变更，尽可能考虑低峰时段的在线变更，比如使用pt-osc工具或者是维护时段的变更，就不再赘述了。</p>
<p>最后总结一下，其实就是一句话：</p>
<p>千万级大表的优化是根据业务场景，以成本为代价进行优化的，绝对不是孤立的一个层面的优化。</p>
<p>点在看，让更多人看到</p>
</the></excerpt>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/04/29/如何优化千万级大表/">如何优化千万级大表</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Phantoms007</a></p>
        <p><span>发布时间:</span>2020-04-29, 20:00:00</p>
        <p><span>最后更新:</span>2020-04-30, 18:41:19</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/04/29/如何优化千万级大表/" title="如何优化千万级大表">https://phantoms007.github.io/2020/04/29/如何优化千万级大表/</a>
            <span class="copy-path" data-clipboard-text="原文: https://phantoms007.github.io/2020/04/29/如何优化千万级大表/　　作者: Phantoms007" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2020/04/29/Post-与-Get-的区别/">
                    Post 与 Get 的区别
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何优化千万级大表"><span class="toc-number">1.</span> <span class="toc-text">如何优化千万级大表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据量：千万级"><span class="toc-number">1.2.</span> <span class="toc-text">数据量：千万级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-数据量为千万级，可能达到亿级或者更高"><span class="toc-number">1.2.1.</span> <span class="toc-text">1)数据量为千万级，可能达到亿级或者更高</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-数据量为千万级，是一个相对稳定的数据量"><span class="toc-number">1.2.2.</span> <span class="toc-text">2)数据量为千万级，是一个相对稳定的数据量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-数据量为千万级，不应该有这么多的数据"><span class="toc-number">1.2.3.</span> <span class="toc-text">3)数据量为千万级，不应该有这么多的数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象：数据表"><span class="toc-number">1.3.</span> <span class="toc-text">对象：数据表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）流水型数据"><span class="toc-number">1.3.1.</span> <span class="toc-text">（1）流水型数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）状态型数据"><span class="toc-number">1.3.2.</span> <span class="toc-text">（2）状态型数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）配置型数据"><span class="toc-number">1.3.3.</span> <span class="toc-text">（3）配置型数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#目标：优化"><span class="toc-number">1.4.</span> <span class="toc-text">目标：优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#改进方案"><span class="toc-number">2.</span> <span class="toc-text">改进方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#规范设计"><span class="toc-number">2.1.</span> <span class="toc-text">规范设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置规范"><span class="toc-number">2.1.1.</span> <span class="toc-text">配置规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#建表规范"><span class="toc-number">2.1.2.</span> <span class="toc-text">建表规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#命名规范"><span class="toc-number">2.1.3.</span> <span class="toc-text">命名规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引规范"><span class="toc-number">2.1.4.</span> <span class="toc-text">索引规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应用规范"><span class="toc-number">2.1.5.</span> <span class="toc-text">应用规范</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#业务层优化"><span class="toc-number">2.2.</span> <span class="toc-text">业务层优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#架构层优化"><span class="toc-number">2.3.</span> <span class="toc-text">架构层优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库优化"><span class="toc-number">2.4.</span> <span class="toc-text">数据库优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务优化"><span class="toc-number">2.5.</span> <span class="toc-text">事务优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-降维策略1：存储过程调用转换为透明的SQL调用"><span class="toc-number">2.5.1.</span> <span class="toc-text">4.1.1 降维策略1：存储过程调用转换为透明的SQL调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-降维策略2：DDL操作转换为DML操作"><span class="toc-number">2.5.2.</span> <span class="toc-text">4.1.2 降维策略2：DDL操作转换为DML操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-降维策略3：Delete操作转换为高效操作"><span class="toc-number">2.5.3.</span> <span class="toc-text">4.1.3 降维策略3：Delete操作转换为高效操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-SQL优化"><span class="toc-number">2.5.4.</span> <span class="toc-text">4.2 SQL优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-索引优化"><span class="toc-number">2.5.5.</span> <span class="toc-text">4.3 索引优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理优化"><span class="toc-number">2.6.</span> <span class="toc-text">管理优化</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>





    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2020/04/29/Post-与-Get-的区别/" title="下一篇: Post 与 Get 的区别">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/29/如何优化千万级大表/">如何优化千万级大表</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/29/Post-与-Get-的区别/">Post 与 Get 的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/28/MySQL性能优化之骨灰级高阶神技/">MySQL性能优化之骨灰级高阶神技</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/26/innodb-添加Sphinx中文快速搜索支持/">innodb 添加Sphinx中文快速搜索支持</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/08/php简单秒杀场景/">php redis简单秒杀场景</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/21/雪花算法及运用PHP/">雪花算法及运用PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/19/并发扣款一致性优化，CAS下ABA问题，这个话题还没聊完！！！/">并发扣款一致性优化，CAS下ABA问题，这个话题还没聊完！！！</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/19/并发扣款，如何保证数据的一致性？/">并发扣款，如何保证数据的一致性？</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/20/动态规划算法-漫画版/">动态规划算法(漫画版)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/19/如何避免回表查询及什么是索引覆盖/">如何避免回表查询及什么是索引覆盖</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/17/Centos6.9 LAMP源码编译参考手册/">Centos7.3 LAMP源码编译参考手册</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/09/MySQL监控/">MySQL监控--初级入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/05/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/29/Windows下生成PDF/">生成复杂PDF-Windows篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/28/LNMP搭建-Linux搭建/">服务器集群-环境搭建（二）Nginx服务器搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/27/虚拟机安装centos/">服务器集群-环境搭建（一）虚拟机安装精简centos7.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/12/Linxu常用工具安装/">Linxu常用工具安装</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2019-2020 Phantoms007
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="/js/require.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 6;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>



  </div>
</body>
</html>